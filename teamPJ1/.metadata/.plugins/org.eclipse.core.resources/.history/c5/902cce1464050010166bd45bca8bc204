<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="pieum.capsule.model.InquiryMapper">

    <!-- 공지/문의 등록 -->
    <insert id="insertNotice" parameterType="pieum.capsule.model.InquiryDTO">
        INSERT INTO inquiries (nno, user_id, title, content, type, created_at)
        VALUES (#{nno}, #{userId}, #{title}, #{content}, #{type}, NOW())
    </insert>

    <!-- 공지/문의 상세 조회 -->
    <select id="selectNoticeDetail" parameterType="string" resultType="pieum.capsule.model.InquiryDTO">
        SELECT * FROM inquiries WHERE nno = #{nno}
    </select>

    <!-- 공지/문의 수정 -->
    <update id="updateNotice" parameterType="pieum.capsule.model.InquiryDTO">
        UPDATE inquiries
        SET title = #{title}, content = #{content}, updated_at = NOW()
        WHERE nno = #{nno}
    </update>

    <!-- 답변 등록/수정 -->
    <update id="updateAnswer" parameterType="pieum.capsule.model.InquiryDTO">
        UPDATE inquiries
        SET answer = #{answer}, answered_at = NOW()
        WHERE nno = #{nno}
    </update>

    <!-- 공지/문의 삭제 -->
    <delete id="deleteNotice" parameterType="string">
        DELETE FROM inquiries WHERE nno = #{nno}
    </delete>

    <!-- 특정 사용자의 1:1 문의 목록 조회 -->
    <select id="selectMyInquiryList" parameterType="string" resultType="pieum.capsule.model.InquiryDTO">
        SELECT * FROM inquiries WHERE user_id = #{userId} ORDER BY created_at DESC
    </select>

    <!-- 답변 대기 중인 문의 목록 조회 -->
    <select id="selectPendingInquiries" resultType="pieum.capsule.model.InquiryDTO">
        SELECT * FROM inquiries WHERE answer IS NULL ORDER BY created_at ASC
    </select>

    <!-- 공지/문의 개수 조회 -->
    <select id="selectNoticeTotalCount" resultType="int">
        SELECT COUNT(*) FROM inquiries
    </select>

</mapper>
